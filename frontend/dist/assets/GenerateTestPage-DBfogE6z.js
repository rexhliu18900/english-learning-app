import{j as S,B as I,E as d,o as _,c as g,w as l,i as k,h as M,e as j,r as a,a as s,d as t,l as q,F as C,m as T,b as i,t as K,p as $}from"./index-DVLVCbr2.js";import{L as A}from"./Layout-COh6nWmu.js";import{g as H,a as J}from"./textbooks-CFMbxFRO.js";import{b as O}from"./tests-DMguu1U4.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"generate-test-page"},X={class:"test-form card"},Y={class:"test-tips card"},Z={__name:"GenerateTestPage",setup(h){const z=j(),b=k([]),v=k([]),V=k(!1),o=M({textbook_id:null,test_type:"unit",unit_numbers:[],point_types:["vocabulary","grammar","sentence"],difficulty:"medium",question_count:15});S(async()=>{await B()}),I(()=>o.textbook_id,async u=>{u&&await E(u)});async function B(){try{b.value=await H(),b.value.length>0&&(o.textbook_id=b.value[0].id)}catch{d.error("加载教材列表失败")}}async function E(u){try{const e=await J(u,{page_size:1e3}),c=new Set;v.value=e.filter(m=>m.unit_id&&!c.has(m.unit_id)?(c.add(m.unit_id),!0):!1)}catch(e){console.error("加载单元失败:",e)}}async function L(){if(!o.textbook_id){d.warning("请选择教材");return}if(o.test_type==="unit"&&o.unit_numbers.length===0){d.warning("请选择至少一个单元");return}if(o.point_types.length===0){d.warning("请选择至少一种知识点类型");return}V.value=!0;try{const u=await O({textbook_id:o.textbook_id,test_type:o.test_type,unit_numbers:o.test_type==="unit"?o.unit_numbers:null,point_types:o.point_types,difficulty:o.difficulty,question_count:o.question_count});u.test_id?(d.success("测试生成成功！"),z.push(`/test/${u.test_id}`)):d.error(u.message||"生成失败")}catch(u){d.error("生成测试失败："+(u.message||"未知错误"))}finally{V.value=!1}}return(u,e)=>{const c=a("el-option"),m=a("el-select"),r=a("el-form-item"),p=a("el-radio-button"),x=a("el-radio-group"),y=a("el-checkbox"),w=a("el-checkbox-group"),P=a("Document"),f=a("el-icon"),U=a("EditPen"),F=a("ChatLineRound"),N=a("el-slider"),D=a("el-button"),G=a("el-form"),R=a("InfoFilled");return _(),g(A,null,{default:l(()=>[s("div",W,[e[18]||(e[18]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},"生成测试"),s("p",{class:"page-subtitle"},"选择测试范围和参数，生成个性化测试题")],-1)),s("div",X,[t(G,{model:o,"label-position":"top"},{default:l(()=>[t(r,{label:"选择教材",required:""},{default:l(()=>[t(m,{modelValue:o.textbook_id,"onUpdate:modelValue":e[0]||(e[0]=n=>o.textbook_id=n),placeholder:"请选择教材",size:"large",style:{width:"100%"}},{default:l(()=>[(_(!0),q(C,null,T(b.value,n=>(_(),g(c,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"测试类型"},{default:l(()=>[t(x,{modelValue:o.test_type,"onUpdate:modelValue":e[1]||(e[1]=n=>o.test_type=n),size:"large"},{default:l(()=>[t(p,{label:"unit"},{default:l(()=>[...e[6]||(e[6]=[i("单元测试",-1)])]),_:1}),t(p,{label:"comprehensive"},{default:l(()=>[...e[7]||(e[7]=[i("综合测试",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),o.test_type==="unit"?(_(),g(r,{key:0,label:"选择单元"},{default:l(()=>[t(w,{modelValue:o.unit_numbers,"onUpdate:modelValue":e[2]||(e[2]=n=>o.unit_numbers=n)},{default:l(()=>[(_(!0),q(C,null,T(v.value,n=>(_(),g(y,{key:n.id,label:n.unit_number},{default:l(()=>[i(K(n.title),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})):$("",!0),t(r,{label:"知识点类型"},{default:l(()=>[t(w,{modelValue:o.point_types,"onUpdate:modelValue":e[3]||(e[3]=n=>o.point_types=n)},{default:l(()=>[t(y,{label:"vocabulary"},{default:l(()=>[t(f,null,{default:l(()=>[t(P)]),_:1}),e[8]||(e[8]=i(" 词汇 ",-1))]),_:1}),t(y,{label:"grammar"},{default:l(()=>[t(f,null,{default:l(()=>[t(U)]),_:1}),e[9]||(e[9]=i(" 语法 ",-1))]),_:1}),t(y,{label:"sentence"},{default:l(()=>[t(f,null,{default:l(()=>[t(F)]),_:1}),e[10]||(e[10]=i(" 句型 ",-1))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"难度等级"},{default:l(()=>[t(x,{modelValue:o.difficulty,"onUpdate:modelValue":e[4]||(e[4]=n=>o.difficulty=n),size:"large"},{default:l(()=>[t(p,{label:"easy"},{default:l(()=>[...e[11]||(e[11]=[i("简单",-1)])]),_:1}),t(p,{label:"medium"},{default:l(()=>[...e[12]||(e[12]=[i("中等",-1)])]),_:1}),t(p,{label:"hard"},{default:l(()=>[...e[13]||(e[13]=[i("困难",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"题目数量"},{default:l(()=>[t(N,{modelValue:o.question_count,"onUpdate:modelValue":e[5]||(e[5]=n=>o.question_count=n),min:5,max:30,step:5,marks:{5:"5",10:"10",15:"15",20:"20",25:"25",30:"30"},"show-input":""},null,8,["modelValue"]),e[14]||(e[14]=s("p",{class:"tip"},"系统将根据选择范围自动推荐最佳题目数量",-1))]),_:1}),t(r,null,{default:l(()=>[t(D,{type:"primary",size:"large",loading:V.value,onClick:L,style:{width:"100%"}},{default:l(()=>[t(f,null,{default:l(()=>[t(U)]),_:1}),e[15]||(e[15]=i(" 生成测试 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),s("div",Y,[s("h3",null,[t(f,null,{default:l(()=>[t(R)]),_:1}),e[16]||(e[16]=i(" 测试说明",-1))]),e[17]||(e[17]=s("ul",null,[s("li",null,"测试包含选择题、填空题、判断题等多种题型"),s("li",null,"每道题目的参考答题时间为2分钟"),s("li",null,"测试完成后可查看详细答题报告和错题分析"),s("li",null,"系统会自动记录您的测试成绩和学习进度")],-1))])])]),_:1})}}},ae=Q(Z,[["__scopeId","data-v-b6488ab5"]]);export{ae as default};
