import{A as b,j as M,B,o as a,l as n,a as e,p,F as g,m as _,v as T,y as D,C as E,g as j,i as u,E as q,D as f,e as H,s as I,t as k,k as L,G as V}from"./index-DVLVCbr2.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";function K(m,i=null){return b.post("/chat/chat",{message:m,textbook_id:i})}const Q={class:"chat-page"},R={key:0,class:"welcome-message"},$={class:"message-avatar"},z={key:0,class:"avatar-emoji"},F={key:1,class:"avatar-emoji"},N={class:"message-content"},P=["innerHTML"],S={class:"message-time"},G={key:1,class:"message assistant loading"},U={key:0,class:"quick-questions"},J=["onClick"],O={class:"input-area"},W={class:"input-wrapper"},X=["onKeydown"],Y=["disabled"],Z={__name:"ChatPage",setup(m){H();const i=u(null),y=u(null),r=u(""),o=u([]),c=u(!1),w=["è¿™ä¸ªå•å…ƒçš„é‡ç‚¹è¯æ±‡æœ‰å“ªäº›ï¼Ÿ","å¸®æˆ‘è§£é‡Šä¸€ä¸‹ç°åœ¨å®Œæˆæ—¶çš„ç”¨æ³•","æ€ä¹ˆåŒºåˆ† since å’Œ for çš„ç”¨æ³•ï¼Ÿ","ç»™æˆ‘è®²è®²è¢«åŠ¨è¯­æ€çš„æ„æˆ"];M(()=>{d()}),B(o.value,()=>{f(()=>d())});function d(){i.value&&(i.value.scrollTop=i.value.scrollHeight)}function x(l){return l.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>")}async function C(l){r.value=l,await v()}async function v(){const l=r.value.trim();if(!(!l||c.value)){o.value.push({role:"user",content:l,timestamp:new Date}),r.value="",c.value=!0;try{const s=await K({message:l,history:o.value.slice(-10).map(t=>({role:t.role,content:t.content}))});o.value.push({role:"assistant",content:s.answer||s.message||"æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•å›ç­”è¿™ä¸ªé—®é¢˜ã€‚",timestamp:new Date})}catch(s){console.error("Chat error:",s),q.error("é—®ç­”å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"),o.value.push({role:"assistant",content:"æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›é—®é¢˜ã€‚è¯·ç¨åå†è¯•ï¼Œæˆ–è€…å°è¯•é‡æ–°è¡¨è¿°æ‚¨çš„é—®é¢˜ã€‚",timestamp:new Date})}finally{c.value=!1,f(()=>d())}}}return(l,s)=>(a(),n("div",Q,[s[6]||(s[6]=e("div",{class:"chat-header"},[e("h2",null,"AI æ™ºèƒ½åŠ©æ•™"),e("span",{class:"subtitle"},"åŸºäºæ•™æå†…å®¹çš„æ™ºèƒ½é—®ç­”")],-1)),e("div",{class:"chat-container",ref_key:"chatContainer",ref:i},[o.value.length===0?(a(),n("div",R,[...s[1]||(s[1]=[e("div",{class:"welcome-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"})])],-1),e("h3",null,"ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ AI æ™ºèƒ½åŠ©æ•™",-1),e("p",null,"æˆ‘å¯ä»¥å¸®åŠ©ä½ è§£ç­”è‹±è¯­å­¦ä¹ ä¸­çš„å„ç§é—®é¢˜ï¼ŒåŒ…æ‹¬ï¼š",-1),e("ul",null,[e("li",null,"è¯æ±‡è§£é‡Šå’Œç”¨æ³•"),e("li",null,"è¯­æ³•çŸ¥è¯†è®²è§£"),e("li",null,"å¥å‹ç»“æ„åˆ†æ"),e("li",null,"é˜…è¯»ç†è§£ç­”ç–‘"),e("li",null,"å†™ä½œæŒ‡å¯¼å»ºè®®")],-1)])])):p("",!0),(a(!0),n(g,null,_(o.value,(t,h)=>(a(),n("div",{key:h,class:I(["message",t.role])},[e("div",$,[t.role==="assistant"?(a(),n("span",z,"ğŸ¤–")):(a(),n("span",F,"ğŸ‘¤"))]),e("div",N,[e("div",{class:"message-text",innerHTML:x(t.content)},null,8,P),e("div",S,k(L(V)(t.timestamp)),1)])],2))),128)),c.value?(a(),n("div",G,[...s[2]||(s[2]=[e("div",{class:"message-avatar"},[e("span",{class:"avatar-emoji"},"ğŸ¤–")],-1),e("div",{class:"message-content"},[e("div",{class:"typing-indicator"},[e("span"),e("span"),e("span")])],-1)])])):p("",!0)],512),o.value.length<3?(a(),n("div",U,[s[3]||(s[3]=e("span",{class:"quick-label"},"è¯•è¯•è¿™æ ·é—®ï¼š",-1)),(a(),n(g,null,_(w,t=>e("span",{class:"quick-question",key:t,onClick:h=>C(t)},k(t),9,J)),64))])):p("",!0),e("div",O,[e("div",W,[T(e("textarea",{"onUpdate:modelValue":s[0]||(s[0]=t=>r.value=t),placeholder:"è¾“å…¥ä½ çš„é—®é¢˜...",onKeydown:E(j(v,["exact","prevent"]),["enter"]),rows:1,ref_key:"inputRef",ref:y},null,40,X),[[D,r.value]]),e("button",{class:"send-btn",onClick:v,disabled:!r.value.trim()||c.value},[...s[4]||(s[4]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),e("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})],-1)])],8,Y)]),s[5]||(s[5]=e("div",{class:"input-hint"},"æŒ‰ Enter å‘é€ï¼ŒShift+Enter æ¢è¡Œ",-1))])]))}},te=A(Z,[["__scopeId","data-v-7c8f26b3"]]);export{te as default};
