import{j as X,E as r,o as d,c as v,w as o,i as b,e as Y,r as s,a,d as t,b as u,l as _,F as Z,m as h,t as m,p as f,g as ee,q as te,h as oe}from"./index-DVLVCbr2.js";import{L as ne}from"./Layout-COh6nWmu.js";import{g as le,p as se,d as ae,u as ie}from"./textbooks-CFMbxFRO.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"textbooks-page"},ue={class:"page-header"},ce={key:0,class:"textbook-list"},pe=["onClick"],_e={class:"textbook-icon"},me={class:"textbook-info"},fe={key:0,class:"textbook-version"},ge={key:0,class:"textbook-stats"},ve={key:0},ye={key:1},we={__name:"TextbooksPage",setup(xe){const U=Y(),y=b([]),p=b(!1),w=b(!1),i=oe({name:"",version:"",file:null});X(async()=>{await x()});async function x(){try{y.value=await le()}catch{r.error("加载教材列表失败")}}function $(l){i.file=l.raw}async function B(){if(!i.name){r.warning("请输入教材名称");return}if(!i.file){r.warning("请选择教材文件");return}w.value=!0;try{const l=await ie(i.file,i.name,i.version||null);l.success?(r.success("教材上传成功！"),p.value=!1,await T({id:l.textbook.id})):r.error(l.message||"上传失败")}catch(l){r.error("上传失败："+(l.message||"未知错误"))}finally{w.value=!1}}async function T(l){try{const e=await se(l.id);e.success?(r.success("教材解析成功！"),await x()):r.error(e.message||"解析失败")}catch{r.error("解析失败")}}async function M(l){try{await te.confirm(`确定要删除《${l.name}》吗？此操作不可恢复。`,"删除确认",{type:"warning"}),await ae(l.id),r.success("删除成功"),await x()}catch(e){e!=="cancel"&&r.error("删除失败")}}function D(l){U.push(`/textbooks/${l.id}`)}function E(l){return{pending:"info",processing:"warning",completed:"success",failed:"danger"}[l]||"info"}function N(l){return{pending:"待解析",processing:"解析中",completed:"已解析",failed:"解析失败"}[l]||l}return(l,e)=>{const q=s("Upload"),c=s("el-icon"),g=s("el-button"),z=s("Document"),L=s("el-tag"),P=s("MoreFilled"),S=s("View"),k=s("el-dropdown-item"),j=s("DocumentCopy"),I=s("Delete"),R=s("el-dropdown-menu"),W=s("el-dropdown"),A=s("el-col"),G=s("el-row"),H=s("el-empty"),F=s("el-input"),C=s("el-form-item"),J=s("UploadFilled"),K=s("el-upload"),O=s("el-form"),Q=s("el-dialog");return d(),v(ne,null,{default:o(()=>[a("div",de,[a("div",ue,[e[8]||(e[8]=a("div",null,[a("h1",{class:"page-title"},"我的教材"),a("p",{class:"page-subtitle"},"管理您的英语学习教材")],-1)),t(g,{type:"primary",onClick:e[0]||(e[0]=n=>p.value=!0)},{default:o(()=>[t(c,null,{default:o(()=>[t(q)]),_:1}),e[7]||(e[7]=u(" 上传教材 ",-1))]),_:1})]),y.value.length>0?(d(),_("div",ce,[t(G,{gutter:20},{default:o(()=>[(d(!0),_(Z,null,h(y.value,n=>(d(),v(A,{xs:24,sm:12,lg:8,key:n.id},{default:o(()=>[a("div",{class:"textbook-card card",onClick:V=>D(n)},[a("div",_e,[t(c,{size:"48"},{default:o(()=>[t(z)]),_:1})]),a("div",me,[a("h3",null,m(n.name),1),n.version?(d(),_("p",fe,"版本："+m(n.version),1)):f("",!0),t(L,{type:E(n.parse_status),size:"small"},{default:o(()=>[u(m(N(n.parse_status)),1)]),_:2},1032,["type"])]),a("div",{class:"textbook-actions",onClick:e[1]||(e[1]=ee(()=>{},["stop"]))},[t(W,{trigger:"click"},{dropdown:o(()=>[t(R,null,{default:o(()=>[t(k,{onClick:V=>D(n)},{default:o(()=>[t(c,null,{default:o(()=>[t(S)]),_:1}),e[9]||(e[9]=u(" 查看详情 ",-1))]),_:1},8,["onClick"]),n.parse_status==="pending"?(d(),v(k,{key:0,onClick:V=>T(n)},{default:o(()=>[t(c,null,{default:o(()=>[t(j)]),_:1}),e[10]||(e[10]=u(" 解析教材 ",-1))]),_:1},8,["onClick"])):f("",!0),t(k,{divided:"",onClick:V=>M(n),type:"danger"},{default:o(()=>[t(c,null,{default:o(()=>[t(I)]),_:1}),e[11]||(e[11]=u(" 删除 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),default:o(()=>[t(c,{size:"20"},{default:o(()=>[t(P)]),_:1})]),_:2},1024)]),n.statistics?(d(),_("div",ge,[a("span",null,"词汇 "+m(n.statistics.vocabulary_count||0),1),n.statistics.grammar_count?(d(),_("span",ve,"语法 "+m(n.statistics.grammar_count),1)):f("",!0),n.statistics.sentence_count?(d(),_("span",ye,"句型 "+m(n.statistics.sentence_count),1)):f("",!0)])):f("",!0)],8,pe)]),_:2},1024))),128))]),_:1})])):(d(),v(H,{key:1,description:"暂无教材"},{default:o(()=>[t(g,{type:"primary",onClick:e[2]||(e[2]=n=>p.value=!0)},{default:o(()=>[...e[12]||(e[12]=[u(" 上传第一本教材 ",-1)])]),_:1})]),_:1})),t(Q,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=n=>p.value=n),title:"上传教材",width:"500px"},{footer:o(()=>[t(g,{onClick:e[5]||(e[5]=n=>p.value=!1)},{default:o(()=>[...e[15]||(e[15]=[u("取消",-1)])]),_:1}),t(g,{type:"primary",loading:w.value,onClick:B},{default:o(()=>[...e[16]||(e[16]=[u(" 上传并解析 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(O,{model:i,"label-position":"top"},{default:o(()=>[t(C,{label:"教材名称",required:""},{default:o(()=>[t(F,{modelValue:i.name,"onUpdate:modelValue":e[3]||(e[3]=n=>i.name=n),placeholder:"例如：人教版八年级下册英语"},null,8,["modelValue"])]),_:1}),t(C,{label:"教材版本（可选）"},{default:o(()=>[t(F,{modelValue:i.version,"onUpdate:modelValue":e[4]||(e[4]=n=>i.version=n),placeholder:"例如：2025年版"},null,8,["modelValue"])]),_:1}),t(C,{label:"教材文件",required:""},{default:o(()=>[t(K,{drag:"",action:"#","auto-upload":!1,"on-change":$,limit:1,accept:".pdf,.docx,.doc,.md"},{tip:o(()=>[...e[13]||(e[13]=[a("div",{class:"el-upload__tip"}," 支持 PDF、Word、Markdown 格式 ",-1)])]),default:o(()=>[t(c,{class:"el-icon--upload"},{default:o(()=>[t(J)]),_:1}),e[14]||(e[14]=a("div",{class:"el-upload__text"},[u(" 拖拽文件到此处，或 "),a("em",null,"点击上传")],-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])]),_:1})}}},Te=re(we,[["__scopeId","data-v-834c03e7"]]);export{Te as default};
