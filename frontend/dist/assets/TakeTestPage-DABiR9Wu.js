import{i as v,j as G,I as K,E as q,o as c,l as d,a as s,t as r,p as g,J as O,F as L,m as A,v as X,y as Y,f as Z,e as ee,z as w,s as $}from"./index-DVLVCbr2.js";import{c as te,s as se}from"./tests-DMguu1U4.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"take-test-page"},ae={class:"test-header"},ie={class:"test-info"},le={class:"test-meta"},re={key:0,class:"timer"},ue={class:"timer-value"},ce={class:"test-progress"},de={class:"progress-bar"},ve={class:"progress-text"},_e={key:0,class:"question-card"},pe={class:"question-header"},fe={class:"question-type"},he={class:"question-score"},me={class:"question-content"},ye=["innerHTML"],ge={key:0,class:"question-options"},we=["onClick"],ke={class:"option-letter"},be=["innerHTML"],Ce={key:1,class:"fill-in-input"},Te=["placeholder"],qe={class:"test-actions"},Se=["disabled"],Ie=["disabled"],Me={class:"question-nav"},xe={class:"nav-dots"},Le=["onClick"],Ae={__name:"TakeTestPage",setup($e){const B=ee(),D=Z(),_=v({title:"综合测试",questionCount:0,duration:10}),n=v([]),a=v(0),f=v({}),h=v({}),p=v(null),y=v(null),m=v(!1),k=v(D.params.testId||null),S=v(null),l=w(()=>n.value[a.value]||{}),H=w(()=>n.value.length===0?0:(a.value+1)/n.value.length*100),Q=w(()=>({easy:"简单",medium:"中等",hard:"困难"})[_.value.difficulty]||"中等"),R=w(()=>({choice:"选择题",fill_in:"填空题",true_false:"判断题",contextual:"阅读理解",matching:"配对题"})[l.value.type]||"选择题");G(async()=>{await z(),V()}),K(()=>{y.value&&clearInterval(y.value)});async function z(){var t;try{if(k.value){const e=await te(k.value);S.value=e,_.value={title:e.title||"测试",questionCount:((t=e.questions)==null?void 0:t.length)||0,duration:e.estimated_time||10,difficulty:e.difficulty},n.value=e.questions||[]}else n.value=I(),_.value={title:"Unit 1-2 综合测试",questionCount:n.value.length,duration:15,difficulty:"medium"}}catch(e){console.error("加载测试失败:",e),q.error("加载测试失败"),n.value=I()}}function I(){return[{id:"q1",type:"choice",question:"What ___ you ___ when the phone rang?",options:["were...doing","are...doing","did...do","do...do"],answer:0,score:5,knowledge_point:"过去进行时"},{id:"q2",type:"choice",question:"She has lived in Beijing ___ 2010.",options:["since","for","in","at"],answer:0,score:5,knowledge_point:"since/for 区别"},{id:"q3",type:"true_false",question:'The passive voice is formed with "be + past participle".',answer:1,score:5,knowledge_point:"被动语态"},{id:"q4",type:"fill_in",question:"Fill in the blank: The book ___ (read) by Mary.",answer:"is read",score:5,knowledge_point:"被动语态"},{id:"q5",type:"choice",question:"___ volume please? I can't hear clearly.",options:["Can you turn up","Can you turn down","Could you turn up","Could you turn down"],answer:2,score:5,knowledge_point:"情态动词"}]}function M(t){var e,o;return((e=n.value[a.value])==null?void 0:e.type)==="fill_in"?((o=h.value[t])==null?void 0:o.trim())!=="":f.value[t]!==void 0}function E(t){f.value[l.value.id]=t}function F(){a.value>0&&a.value--}function P(){a.value<n.value.length-1&&a.value++}function U(t){a.value=t}function V(){p.value=_.value.duration*60,y.value=setInterval(()=>{p.value>0?p.value--:(clearInterval(y.value),q.warning("时间到！正在自动提交..."),x())},1e3)}function j(t){const e=Math.floor(t/60),o=t%60;return`${e.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}async function x(){var t;if(!m.value){m.value=!0;try{const e=n.value.map(i=>({question_id:i.id,answer:i.type==="fill_in"?h.value[i.id]||"":f.value[i.id],is_correct:N(i)})),o={test_id:(t=S.value)==null?void 0:t.id,answers:e,time_spent:_.value.duration*60-p.value};k.value&&await se(o);const u=e.filter(i=>i.is_correct).length,b=n.value.reduce((i,C)=>i+C.score,0),J=e.filter(i=>i.is_correct).reduce((i,C)=>{const T=n.value.find(W=>W.id===C.question_id);return i+((T==null?void 0:T.score)||0)},0);B.push({name:"TestResult",params:{correctCount:u,totalCount:n.value.length,score:J,totalScore:b,timeSpent:o.time_spent}})}catch(e){console.error("提交失败:",e),q.error("提交失败，请重试"),m.value=!1}}}function N(t){if(t.type==="fill_in"){const e=(h.value[t.id]||"").toLowerCase().trim(),o=(t.answer||"").toLowerCase().trim();return e===o}return f.value[t.id]===t.answer}return(t,e)=>(c(),d("div",oe,[s("div",ae,[s("div",ie,[s("h2",null,r(_.value.title),1),s("span",le,r(_.value.questionCount)+" 题 | 预计 "+r(_.value.duration)+" 分钟 | "+r(Q.value),1)]),p.value?(c(),d("div",re,[e[1]||(e[1]=s("span",{class:"timer-icon"},"⏱",-1)),s("span",ue,r(j(p.value)),1)])):g("",!0)]),s("div",ce,[s("div",de,[s("div",{class:"progress-fill",style:O({width:H.value+"%"})},null,4)]),s("span",ve,r(a.value+1)+" / "+r(n.value.length),1)]),n.value.length>0?(c(),d("div",_e,[s("div",pe,[s("span",fe,r(R.value),1),s("span",he,"本题 "+r(l.value.score)+" 分",1)]),s("div",me,[s("div",{class:"question-text",innerHTML:l.value.question},null,8,ye),l.value.options&&l.value.options.length>0?(c(),d("div",ge,[(c(!0),d(L,null,A(l.value.options,(o,u)=>(c(),d("div",{key:u,class:$(["option-item",{selected:f.value[l.value.id]===u}]),onClick:b=>E(u)},[s("span",ke,r(String.fromCharCode(65+u)),1),s("span",{class:"option-text",innerHTML:o},null,8,be)],10,we))),128))])):g("",!0),l.value.type==="fill_in"?(c(),d("div",Ce,[X(s("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>h.value[l.value.id]=o),placeholder:l.value.placeholder||"请输入答案..."},null,8,Te),[[Y,h.value[l.value.id]]])])):g("",!0)])])):g("",!0),s("div",qe,[s("button",{class:"btn btn-secondary",onClick:F,disabled:a.value===0}," 上一题 ",8,Se),a.value<n.value.length-1?(c(),d("button",{key:0,class:"btn btn-primary",onClick:P}," 下一题 ")):(c(),d("button",{key:1,class:"btn btn-success",onClick:x,disabled:m.value},r(m.value?"提交中...":"提交答卷"),9,Ie))]),s("div",Me,[e[2]||(e[2]=s("span",{class:"nav-label"},"题目导航：",-1)),s("div",xe,[(c(!0),d(L,null,A(n.value,(o,u)=>(c(),d("span",{key:o.id,class:$(["nav-dot",{current:u===a.value,answered:M(o.id),current_answered:u===a.value&&M(o.id)}]),onClick:b=>U(u)},r(u+1),11,Le))),128))])])]))}},Qe=ne(Ae,[["__scopeId","data-v-5dc5feab"]]);export{Qe as default};
